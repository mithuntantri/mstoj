"use strict";angular.module("mstojApp",["ngMaterial","ui.router"]).config(["$stateProvider","$urlRouterProvider","$mdThemingProvider","$httpProvider","$locationProvider",function(e,t,o,a,s){o.theme("success-toast"),o.theme("error-toast"),a.interceptors.push("tokenInterceptor"),s.html5Mode(!0),t.otherwise("/dashboard"),t.when("/","/dashboard"),t.when("/login","/dashboard"),e.state("login",{url:"/login",controller:"AdminLoginCtrl",templateUrl:"views/admin/login.html"}).state("dashboard",{url:"/dashboard",controller:"AdminDashboardCtrl",templateUrl:"views/admin/dashboard.html",resolve:{checkToken:["$q",function(e){let t=e.defer();return localStorage.getItem("token")?t.resolve():t.reject("tokenexpired"),t.promise}],getAllProducts:["$q","Login",function(e,t){let o=e.defer();return t.getAllProducts().then(e=>{e.data.status&&e.data.data.length>0?(t.Products=e.data.data,t.selected_product=0):(t.Products=[],t.selected_product=null)}),o.resolve(),o.promise}]}})}]).run(["$location","$rootScope","$state","$window",function(e,t,o,a){t.$on("tokenexpired",function(){o.go("login")}),t.$on("$stateChangeError",(e,t,a,s,i,l)=>{o.go("login")})}]),angular.module("mstojApp").controller("AdminLoginCtrl",["$scope","$state","Login","Toast",function(e,t,o,a){localStorage.removeItem("token"),localStorage.removeItem("admin_type"),localStorage.removeItem("name"),o.loggingIn=!1,e.errorMessage=null,e.Login=o,e.login={username:"",password:""},e.adminLogin=(()=>{o.loggingIn=!0,e.errorMessage=null,o.adminLogin(e.login).then(a=>{a.data.status?(localStorage.setItem("token",a.data.data.token),localStorage.setItem("admin_type",a.data.data.admin_type),localStorage.setItem("name",a.data.data.name),t.go("dashboard")):(o.loggingIn=!1,e.errorMessage=a.data.message)})})}]),angular.module("mstojApp").controller("AdminDashboardCtrl",["$scope","$state","$rootScope","Login","Toast","Files",function(e,t,o,a,s,i){e.Files=i,e.Login=a,e.name=localStorage.getItem("name"),e.admin_type=localStorage.getItem("admin_type"),a.loggingOut=!1,e.upload_options=[{name:"Upload IWS List",selected:"SU"==e.admin_type,restricted:!0},{name:"Upload Product List",selected:!1,restricted:!0},{name:"Upload Product Image",selected:!1,restricted:!0},{name:"Upload Target List",selected:!1,restricted:!0},{name:"Upload Daily Data",selected:"DI"==e.admin_type,restricted:!1}],e.selected_option=e.upload_options[0].name,e.selectOption=(t=>{_.each(e.upload_options,(e,o)=>{e.selected=!1,o==t&&(e.selected=!0)}),e.selected_option=e.upload_options[t].name}),e.adminLogout=(()=>{a.loggingOut=!0,localStorage.removeItem("token"),localStorage.removeItem("name"),localStorage.removeItem("admin_type"),t.go("login")});const l=document.querySelector.bind(document);!function(){l("#triggerFile").addEventListener("click",e=>{e.preventDefault(),l("input[type=file]").click()}),l("#drop").ondragleave=(e=>{l("#drop").classList.remove("active"),e.preventDefault()}),l("#drop").ondragover=l("#drop").ondragenter=(e=>{l("#drop").classList.add("active"),e.preventDefault()}),l("#drop").ondrop=(e=>{l("input[type=file]").files=e.dataTransfer.files,l("footer").classList.add("hasFiles"),l("#drop").classList.remove("active"),e.preventDefault()}),l("input[type=file]").addEventListener("change",function(t){const o=t.target.files;i.uploadFile(t.target,e.selected_option);let a=`${Object.keys(o).map(e=>`<div class="file file--${e}">\n     <div class="name"><span>${o[e].name}</span></div>\n     <div class="progress active"></div>\n     <div class="done">\n\t<a href="" target="_blank">\n      <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" viewBox="0 0 1000 1000">\n\t\t<g><path id="path" d="M500,10C229.4,10,10,229.4,10,500c0,270.6,219.4,490,490,490c270.6,0,490-219.4,490-490C990,229.4,770.6,10,500,10z M500,967.7C241.7,967.7,32.3,758.3,32.3,500C32.3,241.7,241.7,32.3,500,32.3c258.3,0,467.7,209.4,467.7,467.7C967.7,758.3,758.3,967.7,500,967.7z M748.4,325L448,623.1L301.6,477.9c-4.4-4.3-11.4-4.3-15.8,0c-4.4,4.3-4.4,11.3,0,15.6l151.2,150c0.5,1.3,1.4,2.6,2.5,3.7c4.4,4.3,11.4,4.3,15.8,0l308.9-306.5c4.4-4.3,4.4-11.3,0-15.6C759.8,320.7,752.7,320.7,748.4,325z"</g>\n\t\t</svg>\n\t\t\t\t\t\t</a>\n     </div>\n    </div>`).join("")}`;l("#drop").classList.add("hidden"),l("footer").classList.add("hasFiles"),setTimeout(()=>{l(".list-files").innerHTML=a},1e3),Object.keys(o).forEach(e=>{setTimeout(()=>{l(`.file--${e}`).querySelector(".progress").classList.remove("active"),l(`.file--${e}`).querySelector(".done").classList.add("anim")},2e3+2e3*e)})})}()}]),angular.module("mstojApp").factory("tokenInterceptor",["$q","$rootScope",function(e,t){return{request:function(t){t.headers=t.headers||{};let o=localStorage.getItem("token");return o&&(t.headers.Authorization=o),t||e.when(t)},responseError:function(o){return 401===o.status?t.$broadcast("tokenexpired"):502!=o.status&&500!=o.status||t.$broadcast("reloadpage"),o||e.when(o)}}}]);class Toast{constructor(e){this.$mdToast=e}showSuccess(e){this.$mdToast.show(this.$mdToast.simple().textContent(e).hideDelay(3e3).position("top center").theme("success-toast"))}showError(e){this.$mdToast.show(this.$mdToast.simple().textContent(e).hideDelay(3e3).position("top center").theme("error-toast"))}}Toast.$inject=["$mdToast"],angular.module("mstojApp").service("Toast",Toast);class Login{constructor(e){this.$http=e,this.Products=[],this.selected_product=null}adminLogin(e){return this.$http({url:"/api/admin/login",method:"POST",data:e})}adminLogout(){return this.$http({url:"/api/admin/logout",method:"POST"})}getAllProducts(){return this.$http({url:"/api/user/product/names",method:"GET"})}}Login.$inject=["$http"],angular.module("mstojApp").service("Login",Login);class Files{constructor(e,t,o,a){this.$http=e,this.Login=a,this.$timeout=t,this.Toast=o,this.validFormats=["xls","xlsx","csv"],this.validFormats2=["jpg"],this.file_name=null,this.FileMessage=null,this.show_loader=!1}uploadFile(e,t){this.$timeout(()=>{this.enableUpload=!1,this.theFile=e.files[0],this.FileMessage=null,console.log("option",t);var o,a,s,i=this.theFile.name.split(".").pop();if(o="Upload Product Image"==t?-1!==this.validFormats2.indexOf(i):-1!==this.validFormats.indexOf(i),a=1==e.files.length,s=this.theFile.name.length<=64,console.log(o,a,s),o&&a&&s){this.show_loader=!0;var l=new FormData;l.append("file",this.theFile);let e=`/api/admin/upload?option=${t}`;if("Upload Product Image"==t){e+=`&id=${this.Login.Products[this.Login.selected_product].id}&name=${this.Login.Products[this.Login.selected_product].product_category}`}console.log("url",e),this.$http({url:e,method:"POST",headers:{"Content-Type":void 0},data:l}).then(e=>{e.data.status?(this.enableUpload=!1,this.Toast.showSuccess(e.data.message),this.resetUpload()):(this.Toast.showError(e.data.message),this.resetUpload()),this.show_loader=!1}).catch(()=>{this.Toast.showError("Something went wrong while uploading"),this.show_loader=!1,this.resetUpload()}),angular.element("input[type='file']").val(null)}else o?a?s||(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Filename cannot exceed 64 Characters"):(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Cannot upload more than one file at a time"):(this.theFile="",angular.element("input[type='file']").val(null),this.FileMessage="Please upload correct File Name, File extension is not supported")})}resetUpload(){setTimeout(()=>{$("#drop").removeClass("hidden"),$("footer").removeClass("hasFiles"),$("footer").classList.add("hidden"),$(".list-files").innerHTML=""},1e3)}}Files.$inject=["$http","$timeout","Toast","Login"],angular.module("mstojApp").service("Files",Files);